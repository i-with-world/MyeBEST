///////////////////////////////////////////////////////////////////////////////
//                                                                            /
//                                                      18/Jan/2013  21:34:46 /
// IAR ANSI C/C++ Compiler V6.30.6.23336/W32 EVALUATION for ARM               /
// Copyright 1999-2012 IAR Systems AB.                                        /
//                                                                            /
//    Cpu mode     =  thumb                                                   /
//    Endian       =  little                                                  /
//    Source file  =  E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇ /
//                    ÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0.0\MyFunct /
//                    ion\Turn_Control.c                                      /
//    Command line =  E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇ /
//                    ÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0.0\MyFunct /
//                    ion\Turn_Control.c -D IAR -lCN                          /
//                    E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇ /
//                    ÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0.0\RAM_128 /
//                    K\List\ -lB E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì× /
//                    ÊÁÏ\µÚ°Ë½ìÖÇÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0 /
//                    .0.0\RAM_128K\List\ -o E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£× /
//                    ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\ /
//                    20130118\V0.0.0\RAM_128K\Obj\ --no_cse --no_unroll      /
//                    --no_inline --no_code_motion --no_tbaa --no_clustering  /
//                    --no_scheduling --debug --endian=little                 /
//                    --cpu=Cortex-M4 -e --fpu=None --dlib_config             /
//                    D:\Tools\IAR6.30\arm\INC\c\DLib_Config_Normal.h -I      /
//                    E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇ /
//                    ÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0.0\Library /
//                    \CPU\ -I E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ /
//                    \µÚ°Ë½ìÖÇÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0. /
//                    0\Library\Drivers\ADC\ -I E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ /
//                    ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ /
//                    ÓÃ\20130118\V0.0.0\Library\Drivers\FTM\ -I              /
//                    E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇ /
//                    ÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0.0\Library /
//                    \Drivers\GPIO\ -I E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µ /
//                    Ú°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130 /
//                    118\V0.0.0\Library\Drivers\PIT\ -I                      /
//                    E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇ /
//                    ÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0.0\MyFunct /
//                    ion\ -Ol                                                /
//    List file    =  E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇ /
//                    ÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0.0\RAM_128 /
//                    K\List\Turn_Control.s                                   /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME Turn_Control

        #define SHT_PROGBITS 0x1

        EXTERN Black_Position
        EXTERN Turn_Count

        PUBLIC Line_Lost_Flag
        PUBLIC Servo_Temp_D
        PUBLIC Servo_Temp_P
        PUBLIC Total_Weight
        PUBLIC Total_Weight_Last
        PUBLIC Turn_Speed
        PUBLIC Turn_SpeedOut
        PUBLIC Turn_Speed_PID
        PUBLIC Turn_Speed_PID_Out
        PUBLIC Turn_Speednew
        PUBLIC Turn_Speedold

// E:\¿ÎÍâ×ÊÁÏ\·ÉË¼¿¨¶ûÖÇÄÜ³µ\ÈÕ³£×ÊÁÏ\µÚ°Ë½ì×ÊÁÏ\µÚ°Ë½ìÖÇÄÜ³µ\Ö±Á¢³µµ÷ÊÔ\ARM\ARMÑ§Ï°Ê¹ÓÃ\20130118\V0.0.0\MyFunction\Turn_Control.c
//    1 #include "AllHeaders.h"
//    2 /*-----Á¥ÊôÓÚTurn_Speed_PIDº¯Êý-----*/

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//    3 int32s_t Turn_Speed;                               //×ªÏòËÙ¶È
Turn_Speed:
        DS8 4

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//    4 int32s_t Turn_Speedold;                            //ÀúÊ·×ªÏòËÙ¶È
Turn_Speedold:
        DS8 4

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//    5 int32s_t Turn_Speednew;                            //×îÐÂ×ªÏòËÙ¶È
Turn_Speednew:
        DS8 4
//    6 
//    7 
//    8 #define Turn_Kp   3
//    9 #define Turn_Kd   4
//   10 
//   11 
//   12 

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//   13 int Total_Weight = 0;
Total_Weight:
        DS8 4

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//   14 int Total_Weight_Last=0;
Total_Weight_Last:
        DS8 4

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//   15 int Servo_Temp_P = 0;
Servo_Temp_P:
        DS8 4

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//   16 int Servo_Temp_D = 0;
Servo_Temp_D:
        DS8 4

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//   17 int Line_Lost_Flag=0;
Line_Lost_Flag:
        DS8 4
//   18 
//   19 
//   20 /*---Á¥ÊôÓÚTurn_Speed_PID_Outº¯Êý--*/

        SECTION `.bss`:DATA:REORDER:NOROOT(2)
//   21 int32s_t Turn_SpeedOut;                            //×ªÏòÊä³öÖµ£¬ÓÃÓÚÆ½»ºÊä³ö
Turn_SpeedOut:
        DS8 4
//   22 

        SECTION `.text`:CODE:NOROOT(1)
        THUMB
//   23 void Turn_Speed_PID(void)
//   24 {
//   25   int32s_t nP,nD;
//   26   
//   27   if(Black_Position>-50 && Black_Position<50 && Line_Lost_Flag!=0)
Turn_Speed_PID:
        LDR.N    R0,??DataTable1
        LDRSH    R0,[R0, #+0]
        MOVW     R1,#+65487
        SUBS     R0,R0,R1
        UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
        CMP      R0,#+99
        BCS.N    ??Turn_Speed_PID_0
        LDR.N    R0,??DataTable1_1
        LDR      R0,[R0, #+0]
        CMP      R0,#+0
        BEQ.N    ??Turn_Speed_PID_0
//   28   {
//   29     Line_Lost_Flag=0;
        LDR.N    R0,??DataTable1_1
        MOVS     R1,#+0
        STR      R1,[R0, #+0]
//   30   }
//   31   if(Black_Position>=50 && Line_Lost_Flag==0)
??Turn_Speed_PID_0:
        LDR.N    R0,??DataTable1
        LDRSH    R0,[R0, #+0]
        CMP      R0,#+50
        BLT.N    ??Turn_Speed_PID_1
        LDR.N    R0,??DataTable1_1
        LDR      R0,[R0, #+0]
        CMP      R0,#+0
        BNE.N    ??Turn_Speed_PID_1
//   32   {
//   33      Total_Weight=50;
        LDR.N    R0,??DataTable1_2
        MOVS     R1,#+50
        STR      R1,[R0, #+0]
//   34      Line_Lost_Flag=1;
        LDR.N    R0,??DataTable1_1
        MOVS     R1,#+1
        STR      R1,[R0, #+0]
//   35   }
//   36   if(Black_Position<=-50 && Line_Lost_Flag==0)
??Turn_Speed_PID_1:
        LDR.N    R0,??DataTable1
        LDRSH    R0,[R0, #+0]
        MVNS     R1,#+48
        CMP      R0,R1
        BGE.N    ??Turn_Speed_PID_2
        LDR.N    R0,??DataTable1_1
        LDR      R0,[R0, #+0]
        CMP      R0,#+0
        BNE.N    ??Turn_Speed_PID_2
//   37   {
//   38      Total_Weight=-50;
        LDR.N    R0,??DataTable1_2
        MVNS     R1,#+49
        STR      R1,[R0, #+0]
//   39      Line_Lost_Flag=2;
        LDR.N    R0,??DataTable1_1
        MOVS     R1,#+2
        STR      R1,[R0, #+0]
//   40   }
//   41   
//   42   if(Line_Lost_Flag==0)
??Turn_Speed_PID_2:
        LDR.N    R0,??DataTable1_1
        LDR      R0,[R0, #+0]
        CMP      R0,#+0
        BNE.N    ??Turn_Speed_PID_3
//   43   {   
//   44      Total_Weight= Black_Position; 
        LDR.N    R0,??DataTable1_2
        LDR.N    R1,??DataTable1
        LDRSH    R1,[R1, #+0]
        STR      R1,[R0, #+0]
//   45   }
//   46   Servo_Temp_P = (int)(Total_Weight * Turn_Kp);       //¼ÆËã³ö¿ØÖÆÁ¿
??Turn_Speed_PID_3:
        LDR.N    R0,??DataTable1_2
        LDR      R0,[R0, #+0]
        MOVS     R1,#+3
        MULS     R0,R1,R0
        LDR.N    R1,??DataTable1_3
        STR      R0,[R1, #+0]
//   47   Servo_Temp_D = (int)((Total_Weight-Total_Weight_Last)*(Turn_Kd));
        LDR.N    R0,??DataTable1_2
        LDR      R0,[R0, #+0]
        LDR.N    R1,??DataTable1_4
        LDR      R1,[R1, #+0]
        SUBS     R0,R0,R1
        LSLS     R0,R0,#+2
        LDR.N    R1,??DataTable1_5
        STR      R0,[R1, #+0]
//   48   Total_Weight_Last=Total_Weight;
        LDR.N    R0,??DataTable1_4
        LDR.N    R1,??DataTable1_2
        LDR      R1,[R1, #+0]
        STR      R1,[R0, #+0]
//   49   nP=(int32s_t)(Servo_Temp_P); //¼ÆËã±ÈÀý²¿·Ö×ªÏòËÙ¶È
        LDR.N    R0,??DataTable1_3
        LDR      R0,[R0, #+0]
//   50   nD=(int32s_t)(Servo_Temp_D); //¼ÆËãÎ¢·Ö²¿·Ö×ªÏòËÙ¶È
        LDR.N    R1,??DataTable1_5
        LDR      R1,[R1, #+0]
//   51 
//   52   Turn_Speedold = Turn_Speednew;
        LDR.N    R2,??DataTable1_6
        LDR.N    R3,??DataTable1_7
        LDR      R3,[R3, #+0]
        STR      R3,[R2, #+0]
//   53 
//   54   if(nD> 60000) 
        MOVW     R2,#+60001
        CMP      R1,R2
        BLT.N    ??Turn_Speed_PID_4
//   55   {
//   56     nD= 60000;                                       //×ªÏòÎ¢·ÖÏÞ·ù
        MOVW     R1,#+60000
//   57   }
//   58   if(nD<-60000) 
??Turn_Speed_PID_4:
        LDR.N    R2,??DataTable1_8  ;; 0xffff15a0
        CMP      R1,R2
        BGE.N    ??Turn_Speed_PID_5
//   59   {
//   60     nD=-60000;
        LDR.N    R1,??DataTable1_8  ;; 0xffff15a0
//   61   }
//   62 
//   63   Turn_Speed = (nP+nD);
??Turn_Speed_PID_5:
        ADDS     R0,R1,R0
        LDR.N    R1,??DataTable1_9
        STR      R0,[R1, #+0]
//   64 
//   65   Turn_Speednew=Turn_Speed;
        LDR.N    R0,??DataTable1_7
        LDR.N    R1,??DataTable1_9
        LDR      R1,[R1, #+0]
        STR      R1,[R0, #+0]
//   66 
//   67 }
        BX       LR               ;; return
//   68 /*==================================
//   69 º¯ÊýÃû£ºTurn_Speed_PID_Out()
//   70 ×÷ÓÃ  £º¼ÆËã×ªÏòËÙ¶ÈµÄÊä³ö£¬Ê¹×ªÏòÊä³öÆ½»¬
//   71 ±¸×¢  £ºÎÞ
//   72 ====================================*/

        SECTION `.text`:CODE:NOROOT(1)
        THUMB
//   73 void Turn_Speed_PID_Out(void)
//   74 {
//   75  int16s_t nValue;
//   76  nValue = (int16s_t)(Turn_Speednew-Turn_Speedold);
Turn_Speed_PID_Out:
        LDR.N    R0,??DataTable1_7
        LDR      R0,[R0, #+0]
        LDR.N    R1,??DataTable1_6
        LDR      R1,[R1, #+0]
        SUBS     R0,R0,R1
//   77  nValue = (int16s_t)(nValue * (Turn_Count + 1) / (CAR_TURN_PERIOD - 1) + Turn_Speedold);
        SXTH     R0,R0            ;; SignExt  R0,R0,#+16,#+16
        LDR.N    R1,??DataTable1_10
        LDRSH    R1,[R1, #+0]
        ADDS     R1,R1,#+1
        MULS     R0,R1,R0
        MOVS     R1,#+1
        SDIV     R0,R0,R1
        LDR.N    R1,??DataTable1_6
        LDR      R1,[R1, #+0]
        ADDS     R0,R1,R0
//   78  Turn_SpeedOut=nValue;
        LDR.N    R1,??DataTable1_11
        SXTH     R0,R0            ;; SignExt  R0,R0,#+16,#+16
        STR      R0,[R1, #+0]
//   79 // Turn_SpeedOut=0;
//   80 }
        BX       LR               ;; return

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1:
        DC32     Black_Position

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_1:
        DC32     Line_Lost_Flag

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_2:
        DC32     Total_Weight

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_3:
        DC32     Servo_Temp_P

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_4:
        DC32     Total_Weight_Last

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_5:
        DC32     Servo_Temp_D

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_6:
        DC32     Turn_Speedold

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_7:
        DC32     Turn_Speednew

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_8:
        DC32     0xffff15a0

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_9:
        DC32     Turn_Speed

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_10:
        DC32     Turn_Count

        SECTION `.text`:CODE:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
??DataTable1_11:
        DC32     Turn_SpeedOut

        SECTION `.iar_vfe_header`:DATA:REORDER:NOALLOC:NOROOT(2)
        SECTION_TYPE SHT_PROGBITS, 0
        DATA
        DC32 0

        SECTION __DLIB_PERTHREAD:DATA:REORDER:NOROOT(0)
        SECTION_TYPE SHT_PROGBITS, 0

        SECTION __DLIB_PERTHREAD_init:DATA:REORDER:NOROOT(0)
        SECTION_TYPE SHT_PROGBITS, 0

        END
// 
//  36 bytes in section .bss
// 294 bytes in section .text
// 
// 294 bytes of CODE memory
//  36 bytes of DATA memory
//
//Errors: none
//Warnings: none
